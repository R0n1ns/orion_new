–ß–∞—Ç –∏ —á–∞—Ç , —á–æ —Ç–∞–∫–æ–≥–æ

–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
1) –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ ws,–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ –æ–±—ã—á–Ω–æ–º—É http
2) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ : web client --> api gateway --> server
3) –ú–µ—Ç—Ä–∏–∫–∏ , –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—à–∏–±–æ–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ gateway: prometheus –∏ grafana
4) –ë–¥ : –º–∏–Ω–∏–æ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –∏ postgre –¥–ª—è –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ

api gateway :
<h2>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>
  <ul>
      <li>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º</li>
      <li>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ JWT</li>
      <li>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiting) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏</li>
      <li>–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus</li>
      <li>–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ backend-—Å–µ—Ä–≤–∏—Å–∞–º</li>
      <li>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (—á–∞—Ç, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥)</li>
  </ul>
  
  <h2>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
  
  <h3>1. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è</h3>
  <div class="endpoint">
      <strong>–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã:</strong><br>
      <code>/chat</code>, <code>/login</code>, <code>/register</code>, <code>/</code> - HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã<br>
      <strong>API Gateway:</strong><br>
      <code>/service/*</code> - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ backend-—Å–µ—Ä–≤–∏—Å—ã<br>
      <strong>WebSocket:</strong><br>
      <code>/ws</code> - –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π<br>
      <strong>–ú–µ—Ç—Ä–∏–∫–∏:</strong><br>
      <code>/metrics</code> - endpoint –¥–ª—è Prometheus
  </div>
  
  <h3>2. Middleware</h3>
  <p>–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π middleware –≤—ã–ø–æ–ª–Ω—è–µ—Ç:</p>
  <ul>
      <li><strong>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:</strong> –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT-—Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤</li>
      <li><strong>Rate Limiting:</strong>
          <ul>
              <li>–ü—É–±–ª–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP (10 RPS, burst –¥–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤)</li>
              <li>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
          </ul>
      </li>
      <li><strong>–ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö</li>
  </ul>
  
  <h3>3. –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã</h3>
  <p><strong>–ü—É–±–ª–∏—á–Ω—ã–µ (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):</strong></p>
  <ul>
      <li><code>/service/api/register</code></li>
      <li><code>/service/api/login</code></li>
      <li><code>/login</code></li>
      <li><code>/register</code></li>
      <li><code>/metrics</code></li>
      <li><code>/chat</code></li>
      <li><code>/</code></li>
  </ul>
  
  <p><strong>–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç JWT-—Ç–æ–∫–µ–Ω):</strong> –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã</p>
  
  <h3>4. –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h3>
  <div class="metrics">
      <p><code>gateway_request_total</code> - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ –º–µ—Ç–æ–¥–∞–º –∏ –ø—É—Ç—è–º)</p>
      <p><code>gateway_request_duration_seconds</code> - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</p>
      <p><code>gateway_user_request_total</code> - –∑–∞–ø—Ä–æ—Å—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</p>
      <p><code>gateway_user_path_total</code> - –∑–∞–ø—Ä–æ—Å—ã –ø–æ –ø—É—Ç—è–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
      <p><code>gateway_rate_limit_blocked_total</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</p>
  </div>
  
  <h2>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
  <ul>
      <li>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</li>
      <li>–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ rate limiting —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</li>
      <li>–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</li>
      <li>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
      <li>–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</li>
  </ul>

–°–µ—Ä–≤–µ—Ä:

<h2>üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>

<ul>
  <li><strong>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</strong> (JWT)</li>
  <li><strong>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</strong> –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
  <li><strong>WebSocket</strong> –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</li>
  <li><strong>–ß–∞—Ç-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª</strong>:
    <ul>
      <li>–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–æ–≤</li>
      <li>–û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</li>
      <li>–û—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è</li>
    </ul>
  </li>
  <li><strong>–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</strong>:
    <ul>
      <li>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–∫ (MinIO)</li>
      <li>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
    </ul>
  </li>
  <li><strong>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</strong></li>
  <li><strong>–ú–µ—Ç—Ä–∏–∫–∏ Prometheus</strong> –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
</ul>

<h2>üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h2>

<table>
  <tr>
    <td><strong>–Ø–∑—ã–∫</strong></td>
    <td>Go</td>
  </tr>
  <tr>
    <td><strong>–§—Ä–µ–π–º–≤–æ—Ä–∫</strong></td>
    <td>Gorilla Mux</td>
  </tr>
  <tr>
    <td><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</strong></td>
    <td>PostgreSQL (—á–µ—Ä–µ–∑ GORM)</td>
  </tr>
  <tr>
    <td><strong>–•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</strong></td>
    <td>MinIO</td>
  </tr>
  <tr>
    <td><strong>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</strong></td>
    <td>WebSocket (Gorilla)</td>
  </tr>
  <tr>
    <td><strong>–ú–µ—Ç—Ä–∏–∫–∏</strong></td>
    <td>Prometheus</td>
  </tr>
  <tr>
    <td><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</strong></td>
    <td>CORS, JWT</td>
  </tr>
</table>

<h2>üöÄ API Endpoints</h2>

<h3>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
<ul>
  <li><code>POST /service/api/login</code> - –≤—Ö–æ–¥</li>
  <li><code>POST /service/api/register</code> - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</li>
</ul>

<h3>üí¨ –ß–∞—Ç</h3>
<ul>
  <li><code>GET /service/api/chats</code> - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤</li>
  <li><code>POST /service/api/chat</code> - —Å–æ–∑–¥–∞—Ç—å —á–∞—Ç</li>
  <li><code>GET /service/api/messages</code> - –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</li>
  <li><code>POST/PUT /service/api/messages/read</code> - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</li>
</ul>

<h3>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
<ul>
  <li><code>GET /service/api/users</code> - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
  <li><code>PUT /service/api/profile</code> - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</li>
  <li><code>POST /service/api/profile/photo</code> - –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</li>
</ul>

<h3>üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏</h3>
<ul>
  <li><code>POST /service/api/block</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</li>
  <li><code>POST /service/api/unblock</code> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</li>
  <li><code>GET /service/api/block-status</code> - —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</li>
  <li><code>GET /service/api/mutual-block</code> - –≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞</li>
</ul>

<h3>üìä –ú–µ—Ç—Ä–∏–∫–∏</h3>
<ul>
  <li><code>GET /service/metrics</code> - Prometheus metrics</li>
</ul>

<h3>üîå WebSocket</h3>
<ul>
  <li><code>GET /service/ws</code> - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WS</li>
</ul>

<h2>üìà –ú–µ—Ç—Ä–∏–∫–∏</h2>
<p>–°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus:</p>
<ul>
  <li>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</li>
  <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</li>
  <li>–°—á—ë—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤</li>
  <li>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</li>
  <li>–°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫</li>
  <li>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞</li>
</ul>

<h2>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
<ul>
  <li>CORS —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ origin</li>
  <li>JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</li>
  <li>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π</li>
</ul>
